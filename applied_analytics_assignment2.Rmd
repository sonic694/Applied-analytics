---
title: "MATH2406 Applied Analytics"
author: "Steven Byrne (3112668)"
subtitle: 'Assessment 2: Applied Data Project'
output:
  html_document:
    df_print: paged
  word_document: default
---

```{r setup, include=FALSE}
# Chunk labels used to identify code blocks. Useful for error tracking
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = TRUE)
# Globally set default behavior of code chunks
# Warnings and messages are hidden. Code is still shown. Produces a clean output
```

## Setup

```{r libraries}
library(dplyr)
library(ggplot2)
library(readr)
library(magrittr)

set.seed(3112668)
```

---

## Problem 1: Flu vaccination experiment

### Part a) Flu infection number simulation

```{r flu1}
group_a <- 100 # Vaccinated
group_b <- 100 # Not vaccinated

p_flu_vaccine <- 0.10 # 10% change of getting flu
p_flu_none <- 0.30 # 30% change of getting flu

flu_a <- rbinom(1, group_a, p_flu_vaccine)
flu_b <- rbinom(1, group_b, p_flu_none)

# rbinom generates random numbers from a binomial distribution (number, size, probability)
# Simulating a survey of 100 people getting the flu when vaccinated and 100 people getting the flu when they are not vaccinated

no_flu_a <- group_a - flu_a
no_flu_b <- group_b - flu_b
# Calculating how many people didn't get the flu from each group

output <- data.frame(
  Outcome = c("Infected", "Not infected", "Participants"),
  Vaccinated_group = c(flu_a, no_flu_a, group_a),
  Unvaccinated_group = c(flu_b, no_flu_b, group_b)
) # Mimic a clinical statistics table

print(output)
```
From this simulation we can see a difference in that 8% of people vaccinated people got the flu whereas 29% of unvaccinated people got the flu.

### Part b) Simulated data analysis

#### Calculate the probability someone unvaccinated will not get infected

```{r flu2}
prob_unvaccinated_no_infection <- no_flu_b / group_b # Empirical probability unvaccinated people will not get the flu
cat("Probability of someone unvaccinated not getting the flu:", # The cat() prints the message in clear text
    round(prob_unvaccinated_no_infection, 3)) # The 3 rounds the probability to 3 decimal places
```

#### 95% confidence interval for unvaccinated people not getting the flu

```{r flu3}
p_hat <- prob_unvaccinated_no_infection # The sample proportion. This estimates the probability of not getting the flu in this group
n <- group_b # The number of people in the unvaccinated group
se <- sqrt(p_hat * (1 - p_hat) / n) # se stands for Standard Error. It measures the uncertainty in the sample proportion
z_value <- qnorm(0.975) # The Z-score represents the number of standard errors from the normal distribution. In this case its 1.96
print(z_value)

ci_lower <- p_hat - z_value * se # This gives us the lower end of the confidence interval in the population proportion given the standard errors
ci_upper <- p_hat + z_value * se # This gives us the upper end of the confidence interval in the population proportion

cat("We have 95% confidence that the proportion of unvaccinated people who didn't get the flu lies between ", round(ci_lower, 3), " and ", round(ci_upper, 3), ". In other words, this is the probability of not getting the flu when you didn't get the vaccine", "\n") # This is a statement explaining that I am 95% confident the population value is between these two ends
```

#### Population percentage estimated to get infected given 40% vaccine uptake rate

```{r flu4}
percentage_vaccinated <- 0.40
percentage_unvaccinated <- 0.60
# Both percentages add up to 1
# I need to calculate the percentage of infections given the uptake rate whilst taking into account the chance of getting the virus after receiving the vaccine and not receiving the vaccine at all
expected_infections <- (percentage_vaccinated * p_flu_vaccine) + (percentage_unvaccinated * p_flu_none)

cat("The expected percentage of flu infections accross a population where 40% of participants received the vaccine is", round(expected_infections * 100, 1), "%") # Convert the result into a percentage whilst rounding to one decimal place
```

#### Probability of being infected by the flu virus at least 3 times in 10 years whilst receiving the vaccine each year

```{r flu5}
# The question is asking me what the chance that a vaccinated person gets the flu as stated with 10% chance of infection
# The same experiment will be repeated 10 times
# There are only two outcomes 
# Being infected or receiving the vaccine the previous year doesn't alter the chances the following year
# The three conditions mentioned above indicates that this is a binomial distribution
# Since I need to give a probability in terms of a percentage I can work from the other direction (X less or equals too 2)
probability_three_or_more_flu_events <- 1 - pbinom(2, 10, p_flu_vaccine) # Subtract from 1 to give the value I'm looking for
# The pbinom function gives the cumulative probability of 0.9298 which is taking into account someone getting the flu virus no times at all, 1 event or 2 events
probability_two_or_less_flu_events <- pbinom(2, 10, p_flu_vaccine)
probability_three_or_more_flu_events <- 1 - probability_two_or_less_flu_events
cat("There is a", round(probability_two_or_less_flu_events * 100, 1), 
    "% chance of a vaccinated person getting the flu 2 times or less in 10 years.")
cat(" Therefore, the probability of getting the flu at least 3 times in 10 years:", 
    round(probability_three_or_more_flu_events * 100, 1), "% \n")
```

---

## Problem 2: Exponential Distribution and Central Limit Theorem

### Part a) Generate 1000 observations from exponential distribution with mean 10

```{r problem2_a}
lambda <- 1/10
n_obs <- 1000

exp_sample <- rexp(n_obs, rate = lambda)

pop_mean <- 1/lambda
pop_sd <- 1/lambda

sample_mean <- mean(exp_sample)
sample_sd <- sd(exp_sample)

cat("Population mean:", pop_mean, "\n")
cat("Sample mean:", round(sample_mean, 3), "\n")
cat("Population standard deviation:", pop_sd, "\n")
cat("Sample standard deviation:", round(sample_sd, 3), "\n")
```

#### ii. Compare histogram with theoretical density

```{r problem2_a_ii, fig.width=7, fig.height=4}
ggplot(data.frame(x = exp_sample), aes(x = x)) +
  geom_histogram(aes(y = ..density..), bins = 50, fill = "steelblue", alpha = 0.7) +
  stat_function(fun = dexp, args = list(rate = lambda), color = "red", size = 1) +
  labs(title = "Histogram of Exponential Sample vs Theoretical Density",
       x = "Value", y = "Density") +
  xlim(0, 50)
```

### Part b) Generate 1000 sample means of size 2

```{r problem2_b, fig.width=7, fig.height=4}
n_samples <- 1000
sample_size <- 2

sample_means_2 <- replicate(n_samples, mean(rexp(sample_size, rate = lambda)))

ggplot(data.frame(means = sample_means_2), aes(x = means)) +
  geom_histogram(bins = 30, fill = "steelblue", alpha = 0.7) +
  labs(title = "Distribution of Sample Means (n=2)",
       x = "Sample Mean", y = "Frequency")

cat("Mean of sample means:", round(mean(sample_means_2), 3), "\n")
cat("Standard deviation of sample means:", round(sd(sample_means_2), 3), "\n")
cat("Theoretical standard error:", round(pop_sd/sqrt(sample_size), 3), "\n")
```

### Part c) Generate 1000 sample means of size 30

```{r problem2_c, fig.width=7, fig.height=4}
sample_size <- 30

sample_means_30 <- replicate(n_samples, mean(rexp(sample_size, rate = lambda)))

ggplot(data.frame(means = sample_means_30), aes(x = means)) +
  geom_histogram(bins = 30, fill = "steelblue", alpha = 0.7) +
  labs(title = "Distribution of Sample Means (n=30)",
       x = "Sample Mean", y = "Frequency")

cat("Mean of sample means:", round(mean(sample_means_30), 3), "\n")
cat("Standard deviation of sample means:", round(sd(sample_means_30), 3), "\n")
cat("Theoretical standard error:", round(pop_sd/sqrt(sample_size), 3), "\n")
```

---

## Problem 3: Paired t-test for Package Design

### Part a) Conduct one-tailed test

```{r problem3_a}
n <- 20
current_mean <- 7.5
new_mean <- 8.2
sd_diff <- 1.9
alpha <- 0.05

mean_diff <- new_mean - current_mean
se_diff <- sd_diff / sqrt(n)
t_stat <- mean_diff / se_diff
df <- n - 1

p_value <- pt(t_stat, df, lower.tail = FALSE)

cat("Sample mean difference:", mean_diff, "\n")
cat("Standard error of difference:", round(se_diff, 4), "\n")
cat("t-statistic:", round(t_stat, 4), "\n")
cat("Degrees of freedom:", df, "\n")
cat("p-value (one-tailed):", round(p_value, 4), "\n")

if(p_value < alpha) {
  cat("Decision: Reject H0 - The new design is significantly more attractive\n")
} else {
  cat("Decision: Fail to reject H0 - No significant difference in attractiveness\n")
}
```

---

## Problem 4: Bivariate Normal Distribution Tests

### Part a) 10 pairs of observations

```{r problem4_a}
mu1 <- 50; mu2 <- 55; sigma1 <- 10; sigma2 <- 10; rho <- 0.8
n_pairs <- 10

mu <- c(mu1, mu2)
sigma_matrix <- matrix(c(sigma1^2, rho*sigma1*sigma2, 
                        rho*sigma1*sigma2, sigma2^2), nrow = 2)

data_10 <- mvrnorm(n_pairs, mu, sigma_matrix)
x1_10 <- data_10[, 1]
x2_10 <- data_10[, 2]

cat("Group 1 - Mean:", round(mean(x1_10), 2), "SD:", round(sd(x1_10), 2), "\n")
cat("Group 2 - Mean:", round(mean(x2_10), 2), "SD:", round(sd(x2_10), 2), "\n")
cat("Correlation:", round(cor(x1_10, x2_10), 3), "\n")
```

#### ii. Conduct paired t-test

```{r problem4_a_ii}
t_test_10 <- t.test(x1_10, x2_10, paired = TRUE, alternative = "two.sided")
print(t_test_10)

cat("Conclusion: With p-value =", round(t_test_10$p.value, 4), 
    "we", ifelse(t_test_10$p.value < 0.05, "reject", "fail to reject"), 
    "H0 at α = 0.05\n")
```

### Part b) 30 pairs of observations

```{r problem4_b}
n_pairs <- 30

data_30 <- mvrnorm(n_pairs, mu, sigma_matrix)
x1_30 <- data_30[, 1]
x2_30 <- data_30[, 2]

cat("Group 1 - Mean:", round(mean(x1_30), 2), "SD:", round(sd(x1_30), 2), "\n")
cat("Group 2 - Mean:", round(mean(x2_30), 2), "SD:", round(sd(x2_30), 2), "\n")
cat("Correlation:", round(cor(x1_30, x2_30), 3), "\n")
```

#### ii. Conduct paired t-test

```{r problem4_b_ii}
t_test_30 <- t.test(x1_30, x2_30, paired = TRUE, alternative = "two.sided")
print(t_test_30)

cat("Conclusion: With p-value =", round(t_test_30$p.value, 4), 
    "we", ifelse(t_test_30$p.value < 0.05, "reject", "fail to reject"), 
    "H0 at α = 0.05\n")
```

---

## Problem 5: ANOVA for Promotional Scenarios

### Part a) Standard deviation = 30

```{r problem5_a}
n_stores <- 6
sd_sales <- 30
mean_scenario1 <- 50
mean_scenario2 <- 55
mean_scenario3 <- 60

scenario1_sales <- rnorm(n_stores, mean_scenario1, sd_sales)
scenario2_sales <- rnorm(n_stores, mean_scenario2, sd_sales)
scenario3_sales <- rnorm(n_stores, mean_scenario3, sd_sales)

sales_data <- data.frame(
  sales = c(scenario1_sales, scenario2_sales, scenario3_sales),
  scenario = factor(rep(c("Scenario 1", "Scenario 2", "Scenario 3"), each = n_stores))
)

print(sales_data)
```

#### ii. Conduct ANOVA test

```{r problem5_a_ii}
anova_result_a <- aov(sales ~ scenario, data = sales_data)
anova_summary_a <- summary(anova_result_a)
print(anova_summary_a)

p_value_a <- anova_summary_a[[1]]["scenario", "Pr(>F)"]

cat("Conclusion: With p-value =", round(p_value_a, 4), 
    "we", ifelse(p_value_a < 0.05, "reject", "fail to reject"), 
    "H0 at α = 0.05\n")

if(p_value_a < 0.05) {
  tukey_a <- TukeyHSD(anova_result_a)
  print(tukey_a)
}
```

### Part b) Standard deviation = 25

```{r problem5_b}
sd_sales_b <- 25

scenario1_sales_b <- rnorm(n_stores, mean_scenario1, sd_sales_b)
scenario2_sales_b <- rnorm(n_stores, mean_scenario2, sd_sales_b)
scenario3_sales_b <- rnorm(n_stores, mean_scenario3, sd_sales_b)

sales_data_b <- data.frame(
  sales = c(scenario1_sales_b, scenario2_sales_b, scenario3_sales_b),
  scenario = factor(rep(c("Scenario 1", "Scenario 2", "Scenario 3"), each = n_stores))
)

anova_result_b <- aov(sales ~ scenario, data = sales_data_b)
anova_summary_b <- summary(anova_result_b)
print(anova_summary_b)

p_value_b <- anova_summary_b[[1]]["scenario", "Pr(>F)"]

cat("Conclusion: With p-value =", round(p_value_b, 4), 
    "we", ifelse(p_value_b < 0.05, "reject", "fail to reject"), 
    "H0 at α = 0.05\n")

if(p_value_b < 0.05) {
  tukey_b <- TukeyHSD(anova_result_b)
  print(tukey_b)
}
```